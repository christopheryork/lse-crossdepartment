<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.chord path {
  fill-opacity: .67;
  stroke: #000;
  stroke-width: .5px;
}

</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var research_labels = [ "Accounting", "Anthropology", "EI", "Economic History", "Economics", "Education (UCL)", "Finance", "Gender Institute",
                         "Geography", "Government", "Grantham Research Institute", "IR", "International Development",
                         "International History", "Law", "Management", "Mathematics", "Methodology", "Philosophy", "Psychology", "Social Policy", "Sociology", "Statistics" ]

var research = [
  [ 0.0,0.0,0.0,0.0,1.0,0.0,3.0,0.0,0.0,2.0,0.0,1.0,0.0,0.0,3.0,2.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.0,0.0,2.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.0,2.0,1.0 ],
  [ 1.0,0.0,0.0,0.0,1.0,0.0,0.0,1.0,2.0,0.0,0.0,8.0,0.0,3.0,4.0,2.0,1.0,0.0,1.0,0.0,3.0,3.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,1.0,2.0,0.0,0.0,0.0,1.0,1.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,2.0,0.0,2.0,3.0,2.0,8.0,0.0,0.0,0.0,1.0,0.0,3.0,2.0,0.0,0.0,0.0,0.0,4.0,0.0,1.0 ],
  [ 0.0,0.0,2.0,1.0,0.0,0.0,0.0,1.0,1.0,1.0,0.0,2.0,1.0,0.0,2.0,1.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0 ],
  [ 0.0,2.0,0.0,0.0,0.0,0.0,0.0,3.0,0.0,3.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,3.0,0.0,1.0 ],
  [ 0.0,0.0,8.0,0.0,6.0,0.0,0.0,1.0,0.0,0.0,0.0,7.0,0.0,4.0,9.0,3.0,0.0,3.0,4.0,0.0,0.0,6.0,0.0 ],
  [ 0.0,0.0,0.0,1.0,2.0,0.0,0.0,1.0,1.0,0.0,0.0,0.0,0.0,4.0,0.0,0.0,1.0,1.0,0.0,0.0,3.0,2.0,0.0 ],
  [ 1.0,0.0,0.0,1.0,0.0,0.0,0.0,3.0,3.0,2.0,0.0,0.0,0.0,0.0,2.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0 ],
  [ 0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,2.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,4.0,0.0,0.0,0.0,2.0,1.0,2.0,3.0,0.0,2.0,0.0,0.0 ],
  [ 0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.0,3.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0 ],
  [ 0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,1.0,0.0,0.0,0.0,0.0,0.0,2.0,2.0,0.0,0.0,0.0,1.0,1.0,1.0,0.0 ],
  [ 0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,1.0,0.0,2.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,1.0 ],
  [ 1.0,0.0,0.0,1.0,0.0,0.0,0.0,2.0,0.0,3.0,0.0,0.0,4.0,0.0,0.0,1.0,0.0,1.0,0.0,0.0,0.0,4.0,1.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,1.0,0.0,0.0,3.0,1.0,0.0,0.0,0.0,2.0,2.0,5.0,1.0,0.0,2.0,1.0,0.0,2.0,0.0,1.0 ],
  [ 0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,1.0,0.0,1.0,0.0,0.0,0.0,0.0 ],
];

var teaching_labels = [ "Accounting","Anthropology","EI","Economic History","Economics","Finance","Gender",
                        "Gender Institute","Geography","Geography and Environment","Government","International Development",
                        "International History","International Relations","Law","Logic","Hygiene and Tropical Medicine",
                        "Management","Mathematics","Media and Communications","NY Law School","Philosophy","Scientific Method",
                        "Social Policy","Sociology","Statistics" ]

var teaching = [
  [ 0.0,0.0,0.0,0.0,1.0,3.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,1.0,0.0,1.0,0.0,1.0,0.0,1.0,2.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,1.0,1.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,1.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 1.0,1.0,0.0,0.0,0.0,1.0,1.0,0.0,1.0,2.0,2.0,0.0,0.0,0.0,1.0,2.0,0.0,1.0,2.0,1.0,0.0,2.0,2.0,1.0,1.0,1.0 ],
  [ 3.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0 ],
  [ 0.0,1.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,1.0,1.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,1.0,0.0,0.0,1.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,1.0,1.0 ],
  [ 1.0,0.0,0.0,0.0,2.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,1.0,1.0,0.0,2.0,0.0,1.0,0.0,1.0,0.0,0.0,1.0,2.0,2.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,1.0,0.0,1.0,1.0,1.0 ],
  [ 0.0,2.0,1.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,1.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.0,0.0,0.0,3.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.0,1.0,3.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 1.0,2.0,0.0,0.0,1.0,0.0,1.0,0.0,1.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,1.0,1.0 ],
  [ 0.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.0,2.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,2.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0 ],
  [ 0.0,1.0,0.0,0.0,1.0,0.0,1.0,1.0,1.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,1.0,1.0 ],
  [ 0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0 ],
  [ 0.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0,0.0,2.0,0.0,0.0,0.0,0.0 ],
  [ 0.0,1.0,0.0,0.0,1.0,0.0,1.0,0.0,1.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,1.0,1.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,1.0 ],
  [ 0.0,1.0,1.0,0.0,1.0,0.0,1.0,0.0,1.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,1.0 ],
  [ 0.0,1.0,0.0,0.0,1.0,1.0,1.0,0.0,1.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,1.0,0.0,0.0,0.0,1.0,1.0,0.0 ]
];


// Javascript... why such circumlocution?!?

var all_labels = [];
[].concat(research_labels).concat(teaching_labels).forEach( (x) => {
  if(all_labels.indexOf(x) === -1) {
    all_labels.push(x)
  }
})
all_labels.sort()

var sizes = all_labels.map( (dept) => {
  var plus = (x,y) => x + y

  var r_idx = research_labels.indexOf(dept)
  var t_idx = teaching_labels.indexOf(dept)

  r = research[r_idx]
  t = teaching[t_idx]

  r = r ? r.reduce(plus) : 0
  t = t ? t.reduce(plus) : 0

  return r + t
})

// visualization proper

var width = 1200,
    height = 400,
    innerRadius = Math.min(width / 2.0, height) * .41,
    outerRadius = innerRadius * 1.05;

var fill = d3.scale.category20c()

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 4.0 + "," + height / 2 + ")");


function viz(elem, matrix, labels, fade) {

  function classize(s) {
    return s.replace(' ', '_')
  }

  var chord = d3.layout.chord()
      .padding(.02)
      .sortSubgroups(d3.descending)
      .matrix(matrix);

  var arc1 = d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius)
  var arc2 = d3.svg.arc().innerRadius(outerRadius).outerRadius(outerRadius + 20)

  var dept = elem.append("g").selectAll("g.dept")
       .data(chord.groups)
     .enter()
       .append("g")
       .attr("class", "dept")

  dept.append("path")
      .style("fill", function(d) { return fill(d.index); })
      .style("stroke", function(d) { return fill(d.index); })
      .attr("d", arc1)
      .on("mouseover", fade(.1))
      .on("mouseout", fade(1))

  dept.append("text")
      .attr("transform", (d) => "translate(" + arc2.centroid(d) + ")")
      .attr("text-anchor", (d) => d.index < 12 ? "start" : "end")
      .text( (d) => labels[d.index] )

  elem.append("g")
      .attr("class", "chord")
    .selectAll("path")
      .data(chord.chords)
    .enter().append("path")
      .attr("class", (d) => classize(labels[d.target.index]) + " " + classize(labels[d.source.index]))
      .attr("d", d3.svg.chord().radius(innerRadius))
      .style("fill", function(d) { return fill(d.target.index); })
      .style("opacity", 1);
}


viz(svg.append("g"), research, all_labels, fade)
viz(svg.append("g").attr("transform", "translate(" + width / 2.0 + ",0)"), teaching, all_labels, fade)


// Returns an event handler for fading a given chord group.
function fade(opacity) {
  return function(g, i) {
    svg.selectAll(".chord path")
        .filter(function(d) { return d.source.index != i && d.target.index != i; })
      .transition()
        .style("opacity", opacity);
  };
}

</script>